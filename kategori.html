<!DOCTYPE html>
<html lang="id">
<head>
    <link rel="icon" type="image/png" href="VRM.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>ORDER SP VRM</title>
    
    <!-- Import Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* === GLOBAL STYLE === */
body {
    font-family: 'Montserrat', sans-serif;
    background: url('bgweb.png') no-repeat center center fixed;
    background-size: cover;
    padding: 20px;
    text-align: center;
    color: #fff; /* default text putih */
}

h1, h2, h3, h4, h5, h6 {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
}

#searchBox {
    padding: 10px;
    width: 90%;
    max-width: 300px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 20px;
    font-family: 'Montserrat', sans-serif;
}
        
/* === MAIN BOX === */
.main-box {
    background-color: rgba(255, 255, 255, 0.08); /* transparan */
    padding: 20px 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 1000px;
    margin: 20px auto;
    

    /* DOUBLE GLOW: merah + ungu */
    box-shadow: 
        0 8px 20px rgba(255, 0, 0, 0.35),   /* glow merah */
        0 0 35px rgba(106, 13, 173, 0.6);  /* glow ungu */
    
}

/* Responsive HP */
@media (max-width: 768px) {
    body {
        padding: 0 10px;   /* jarak kiri kanan */
    }
    .main-box {
        width: 100%;       /* biar full hampir ke tepi */
        margin: 10px auto;
        margin: 15px 20px;
    }
}

/* Responsive layar besar (monitor gede) */
@media (min-width: 1400px) {
    .main-box {
        max-width: 1200px; /* biar nggak keliatan kekecilan */
        padding: 40px;
    }
}       
        
/* === CATEGORY CARD === */
    .category {
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        background: #6a0dad; /* ungu tua */
        color: white;
        padding: 10px;
        margin: 10px auto;
        cursor: pointer;
        width: 90%;
        max-width: 600px;
        border-radius: 5px;
        box-shadow: 0 6px #4b0082;
        text-align: left;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.3s, transform 0.3s;
    }
    .category img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 5px;
    }
    .category:hover {
        background-color: #7d27c1; /* ungu lebih terang saat hover */
        transform: scale(1.05);
        box-shadow: 0 8px #4b0082;
    }
    
    /* === SPAREPART LIST === */
    .spareparts {
        max-height: 0;
        overflow-y: auto;
        transition: max-height 0.4s ease-out, padding 0.3s ease;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 5px;
        width: 80%;
        max-width: 400px;
        padding: 0 10px;
        text-align: left;
    }
    .spareparts.open {
        max-height: 600px;
        padding: 10px;
    }
    .spareparts li {
        list-style: none;
        padding: 5px 0;
        border-bottom: 1px solid #ddd;
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: 'Montserrat', sans-serif;
        font-weight: 500;
        color: #222; /* biar kontras dengan background putih */
    }
    .spareparts li img.spare-img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 5px;
    }
    
    /* === BUTTON === */
    .btn {
        font-family: 'Montserrat', sans-serif;
        font-weight: bold;
        padding: 15px 30px;
        background-color: #6a0dad; /* ungu tua */
        color: #ffffff;
        text-decoration: none;
        font-size: 1.2rem;
        border-radius: 10px;
        box-shadow: 0 6px #4b0082;
        transition: all 0.3s ease;
    }
    .btn:hover {
        background-color: #7d27c1;
        transform: scale(1.05);
        box-shadow: 0 8px #4b0082;
    }
    .btn:active {
        transform: translateY(2px);
        box-shadow: 0 4px #2b4afc;
    }
    
    /* === IMAGE PREVIEW === */
    .large-image {
        display: none;
        width: 200px;
        height: 200px;
        object-fit: cover;
        border-radius: 5px;
        margin-top: 10px;
        margin-left: 10px;
    }
    .show-large-image {
        display: block;
    }
    .show-large-image .small-image,
    .show-large-image .spare-text {
        display: none;
    }
    /* === Keranjang === */
    #cart-icon {
        position: fixed;
        top: 20px;
        right: 30px;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px 15px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(106,13,173,0.7);
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease; /* biar halus */
    }
    #cart-count {
        font-family: 'Montserrat', sans-serif;
        background: red;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 12px;
        position: absolute;
        top: 0;
        right: 0;
        transform: translate(50%,-50%);
    }
    #cart-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 350px;
      height: 100%;
      background: linear-gradient(180deg, rgba(178,82,255,0.85) 0%, rgba(60,0,100,0.85) 100%);
      box-shadow: -4px 0 25px rgba(0,0,0,0.4);
      transition: right 0.4s ease;
      color: white;
      display: flex;
      flex-direction: column;
      z-index: 999;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    #cart-items {
      background: transparent !important;
    }
    #cart-sidebar.open { right: 0; }
    #cart-items { flex: 1; overflow-y: auto; text-align: left; padding: 15px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .cart-item span { font-size: 14px; }
    .remove-btn {
        background: transparent;
        border: none;
        color: #ff8080;
        font-size: 16px;
    }
    #checkout-btn:hover { background: #2793c1; color: white; }
    #simpan-btn:hover { background: #2793c1; color: white; }

    .btn-add {
      font-family: 'Montserrat', sans-serif;
      background-color: #6a0dad; /* ungu elegan */
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 0 #4b0082;
    }
    
    /* Efek hover */
    .btn-add:hover {
      background-color: #8b00ff;
      transform: scale(1.07);
      box-shadow: 0 6px 10px rgba(107, 0, 255, 0.3);
    }
    
    /* Efek saat tombol ditekan */
    .btn-add:active {
      transform: scale(0.95);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    @keyframes cartShake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      50% { transform: rotate(10deg); }
      75% { transform: rotate(-8deg); }
      100% { transform: rotate(0deg); }
    }
    
    .cart-shake {
      animation: cartShake 0.4s ease;
    }

    #print-btn {
      background-color: #444;
      color: white;

    }
    #print-btn:hover {
      background-color: #666;
      transform: scale(1.05);
    }
    #logoutBtn:hover {
      background-color: #e74c3c;
      transform: scale(1.05);
    }
    </style>
</head>
<body>
  <!-- konten halaman kamu di bawah -->
    <div id="cart-icon">üõí<span id="cart-count">0</span></div>
    <div id="cart-sidebar">
    <h2 style="text-align:center; margin-top:20px;">CART</h2>
    <div class="cart-info">
      <label>Nama Produk:</label>
      <input type="text" id="productName" placeholder="Masukkan nama produk..." style="width:100%; margin-bottom:8px; border:none; border-radius:4px; padding:5px;">
      <label>Nomor SN:</label>
      <input type="text" id="serialNumber" placeholder="Masukkan nomor SN..." style="width:100%; border:none; border-radius:4px; padding:5px;">
      <label>Keterangan:</label>
      <input type="text" id="Keterangan" placeholder="Masukkan keterangan..." style="width:100%; border:none; border-radius:4px; padding:5px;">
    </div>
    <div id="cart-items"></div>
    <button id="simpan-btn" class="btn" onclick="simpanOrder()">Simpan</button>
    <button id="checkout-btn" class="btn">Order via WhatsApp</button>
    <button id="print-btn" class="btn">üñ®Ô∏è Print Data</button>
    <button id="logoutBtn" class="btn" style="background-color: #b22222; margin-top:10px;">üö™ Logout</button>
    </div>
    <div class="main-box">
    <h1>KATALOG</h1>

    <input type="text" id="searchBox" placeholder="Cari sparepart...">

    <div class="category" onclick="toggleSpareparts(0)">
        <img src="cervical.png" alt="DR LASER EVO">
        DR QYU CERVICAL
        <span class="arrow">‚ñ∂</span>
    </div>
    <ul class="spareparts">
      <li onclick="showImage(this)">
        <button class="btn-add" onclick="event.stopPropagation(); flyToCart(this); addToCart('ZCTD.ABT - AIRBAG TRAY CERVICAL')">ORDER</button>
        <img src="images/abt.png" alt="ZCTD.ABT" class="spare-img small-image">
        <span class="spare-text">ZCTD.ABT - AIRBAG TRAY CERVICAL</span>
        <img src="images/abt.png" alt="ZCTD.ABT" class="large-image">
      </li>
    
      <li onclick="showImage(this)">
        <button class="btn-add" onclick="event.stopPropagation(); flyToCart(this); addToCart('ZCTD.APUMP - AIRPUMP CERVICAL')">ORDER</button>
        <img src="images/apump.png" alt="ZCTD.APUMP" class="spare-img small-image">
        <span class="spare-text">ZCTD.APUMP - AIRPUMP CERVICAL</span>
        <img src="images/apump.png" alt="ZCTD.APUMP" class="large-image">
      </li>
    
      <li onclick="showImage(this)">
        <button class="btn-add" onclick="event.stopPropagation(); flyToCart(this); addToCart('ZCTD.BOLT - BOLT CERVICAL')">ORDER</button>
        <img src="images/bolt.png" alt="ZCTD.BOLT" class="spare-img small-image">
        <span class="spare-text">ZCTD.BOLT - BOLT CERVICAL</span>
        <img src="images/bolt.png" alt="ZCTD.BOLT" class="large-image">
      </li>
    
      <li onclick="showImage(this)">
        <button class="btn-add" onclick="event.stopPropagation(); flyToCart(this); addToCart('ZCTD.CC8P - CONTROL CABLE 8 PIN CERVICAL')">ORDER</button>
        <img src="images/cc8p.png" alt="ZCTD.CC8P" class="spare-img small-image">
        <span class="spare-text">ZCTD.CC8P - CONTROL CABLE 8 PIN CERVICAL</span>
        <img src="images/cc8p.png" alt="ZCTD.CC8P" class="large-image">
      </li> 
    </ul>

    <br>
    <a href="index.html" class="btn">Kembali</a>

    <script>
        const cartIcon = document.getElementById('cart-icon');
        const cartSidebar = document.getElementById('cart-sidebar');
        const cartCount = document.getElementById('cart-count');
        const cartItemsDiv = document.getElementById('cart-items');
        
        
        let cart = JSON.parse(localStorage.getItem('cartData')) || [];
        updateCartDisplay();
        
        
        cartIcon.addEventListener('click', () => {
        cartSidebar.classList.toggle('open');
        });
        
        
        function toggleSpareparts(index) {
        const lists = document.querySelectorAll('.spareparts');
        lists[index].classList.toggle('open');
        }
        
        
        function addToCart(item) {
        const existing = cart.find(i => i.name === item);
        if (existing) {
        existing.qty++;
        } else {
        cart.push({ name: item, qty: 1 });
        }
        localStorage.setItem('cartData', JSON.stringify(cart));
        updateCartDisplay();
        }
        
        
        function removeItem(name) {
        cart = cart.filter(i => i.name !== name);
        localStorage.setItem('cartData', JSON.stringify(cart));
        updateCartDisplay();
        }
        
        
        function updateCartDisplay() {
        cartItemsDiv.innerHTML = '';
        let total = 0;
        cart.forEach(i => {
        total += i.qty;
        const div = document.createElement('div');
        div.classList.add('cart-item');
        div.innerHTML = `<span>${i.name} (x${i.qty})</span><button class='remove-btn' onclick="removeItem('${i.name}')">‚ùå</button>`;
        cartItemsDiv.appendChild(div);
        });
        cartCount.textContent = total;
        }
        
        
        document.getElementById('checkout-btn').addEventListener('click', () => {
        if (cart.length === 0) {
        alert('Keranjang masih kosong!');
        return;
        }
        let message = 'Halo, saya ingin memesan sparepart berikut:%0A';
        cart.forEach((i, idx) => {
        message += `${idx + 1}. ${i.name} (x${i.qty})%0A`;
        });
        const phone = '6285887588346'; // nomor WA tujuan
        window.open(`https://wa.me/${phone}?text=${message}`, '_blank');
});
        function toggleSpareparts(index) {
            let allLists = document.querySelectorAll(".spareparts");
            let allArrows = document.querySelectorAll(".arrow");

            allLists.forEach((list, i) => {
                if (i === index) {
                    list.classList.toggle("open");
                    allArrows[i].classList.toggle("rotate");
                } else {
                    list.classList.remove("open");
                    allArrows[i].classList.remove("rotate");
                }
            });
        }

        function showImage(element) {
            const largeImage = element.querySelector('.large-image');
            const smallImage = element.querySelector('.small-image');
            const spareText = element.querySelector('.spare-text');

            // Cek apakah gambar besar sudah ditampilkan
        if (largeImage.style.display === 'block') {
            // Jika gambar besar sudah ditampilkan, sembunyikan dan tampilkan gambar kecil serta teks
            largeImage.style.display = 'none';
            smallImage.style.display = 'block';
            spareText.style.display = 'block';
        } else {
        // Jika gambar besar belum ditampilkan, tampilkan gambar besar dan sembunyikan gambar kecil serta teks
        largeImage.style.display = 'block';
        smallImage.style.display = 'none';
        spareText.style.display = 'none';
        }
        }
        document.getElementById("searchBox").addEventListener("input", function() {
            let filter = this.value.toLowerCase();
            let allLists = document.querySelectorAll(".spareparts");
            let allArrows = document.querySelectorAll(".arrow");

            allLists.forEach((list, i) => {
                let items = list.querySelectorAll("li");
                let adaYangCocok = false;

                items.forEach(item => {
                    let text = item.textContent.toLowerCase();
                    if (text.includes(filter)) {
                        item.style.display = "";
                        adaYangCocok = true;
                    } else {
                        item.style.display = "none";
                    }
                });

                if (filter === "") {
                    list.classList.remove("open");
                    allArrows[i].classList.remove("rotate");
                } else if (adaYangCocok) {
                    list.classList.add("open");
                    allArrows[i].classList.add("rotate");
                } else {
                    list.classList.remove("open");
                    allArrows[i].classList.remove("rotate");
                }
            });
        });

    function flyToCart(btn) {
      const cartIcon = document.getElementById("cart-icon");
      const productImg = btn.parentElement.querySelector(".spare-img");
      
      if (!productImg) return;
    
      // clone gambar
      const imgClone = productImg.cloneNode(true);
      const imgRect = productImg.getBoundingClientRect();
      const cartRect = cartIcon.getBoundingClientRect();
        
      // gaya awal clone
      imgClone.style.position = "fixed";
      imgClone.style.left = imgRect.left + "px";
      imgClone.style.top = imgRect.top + "px";
      imgClone.style.width = "40px";
      imgClone.style.height = "40px";
      imgClone.style.borderRadius = "8px";
      imgClone.style.transition = "all 0.8s ease-in-out";
      imgClone.style.zIndex = "2000";
    
      document.body.appendChild(imgClone);
    
       // Animasi terbang ke keranjang
      setTimeout(() => {
        imgClone.style.left = cartRect.left + cartRect.width / 2 + "px";
        imgClone.style.top = cartRect.top + "px";
        imgClone.style.width = "10px";
        imgClone.style.height = "10px";
        imgClone.style.opacity = "0.3";
      }, 10);
    
      // Hapus clone + getar ikon setelah animasi
      setTimeout(() => {
        imgClone.remove();
        cartIcon.classList.add("cart-shake");
        setTimeout(() => cartIcon.classList.remove("cart-shake"), 400);
      }, 900);
    }

function printOrder() {

  const items = document.querySelectorAll("#cart-items .cart-item");

  const productName = document.getElementById("productName")?.value?.trim() || "-";
  const serialNumber = document.getElementById("serialNumber")?.value?.trim() || "-";
  const Keterangan = document.getElementById("Keterangan")?.value?.trim() || "-";

  let tableRows = "";

  items.forEach((item, index) => {
    const text = item.querySelector("span").textContent.trim();
    const parts = text.split(" - ");
    const code = parts[0] || "";
    let name = parts[1] || "";
    let qty = "1";

    const qtyMatch = name.match(/\(x(\d+)\)/);
    if (qtyMatch) {
      qty = qtyMatch[1];
      name = name.replace(/\(x\d+\)/, "").trim();
    }

    tableRows += `
      <tr>
        <td>${index + 1}</td>
        <td>${code}</td>
        <td>${name}</td>
        <td>${qty}</td>
      </tr>
    `;
  });

  const now = new Date();
  const tanggal = now.toLocaleDateString('id-ID');
  const jam = now.toLocaleTimeString('id-ID');

  const printWindow = window.open('', '', 'width=600,height=300');

  printWindow.document.write(`
    <html>
    <head>
      <title>Print Sparepart Verimark</title>
      <style>
        body {
          font-family: 'Montserrat', sans-serif;
          color: #222;
          padding: 10px;
          background: #fff;
          font-size: 9px
        }
        .wrapper {
          border: 2px solid #6a0dad;
          border-radius: 2px;
          padding: 5px 10px;
        }
        h2 {
          text-align: center;
          color: #6a0dad;
          margin-bottom: 10px;
          text-transform: uppercase;
        }
        .info {
          margin-bottom: 10px;
          font-size: 12px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
        }
        th, td {
          border: 1px solid #ccc;
          padding: 6px;
          text-align: left;
          font-size: 9px;
        }
        th {
          background-color: #f0e6ff;
          color: #333;
        }
        tr:nth-child(even) {
          background-color: #faf8ff;
        }
        .footer {
          text-align: left;
          margin-top: 5px;
          font-size: 9px;
          color: #333;
        }
        .sign-section {
          margin-top: 5px;
          display: flex;
          justify-content: space-around;
          text-align: center;
        }
        .sign-box {
          width: 30%;
        }
        .sign-box .line {
          margin-top: 40px;
          border-top: 1px solid #333;
          width: 100%;
        }
      </style>
    </head>
    <body>
      <div class="wrapper">
        <h2>FORM PERMINTAAN SPAREPART</h2>
        <div class="info">
          <p><strong>Nama Produk:</strong> ${productName}</p>
          <p><strong>Nomor SN:</strong> ${serialNumber}</p>
          <p><strong>Keterangan:</strong> ${Keterangan}</p>
        </div>
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th>Kode</th>
              <th>Nama Sparepart</th>
              <th>Qty</th>
            </tr>
          </thead>
          <tbody>
            ${tableRows}
          </tbody>
        </table>
        <div class="footer">
          <p><strong>Tanggal cetak:</strong> ${tanggal} ‚Äî <strong>Jam:</strong> ${jam}</p>
          <p>Dicetak dari sistem internal Verimark</p>
        </div>
        <div class="sign-section">
          <div class="sign-box">
            <p><strong>Dibuat oleh</strong></p>
            <div class="line"></div>
          </div>
          <div class="sign-box">
            <p><strong>Mengetahui</strong></p>
            <div class="line"></div>
          </div>
          <div class="sign-box">
            <p><strong>Menyetujui</strong></p>
            <div class="line"></div>
          </div>
        </div>
      </div>
      <script>
        window.onload = function(){
          window.print();
          window.onafterprint = function(){ window.close(); }
        }
      <\/script>

    </body>
    </html>
  `);

  printWindow.document.close();
}

// tombol print manual
document.getElementById("print-btn").addEventListener("click", printOrder);

        // Cek apakah sudah login
  if (localStorage.getItem("isLoggedIn") !== "true") {
    alert("Kamu harus login dulu sebelum mengakses halaman ini!");
    window.location.href = "login.html";
  }

// Cek login
  if (localStorage.getItem("isLoggedIn") !== "true") {
    window.location.href = "login.html";
  }

  // Tombol logout
  document.getElementById("logoutBtn").addEventListener("click", function() {
    localStorage.removeItem("isLoggedIn");
    alert("Kamu sudah logout üëã");
    window.location.href = "login.html";
  });

async function simpanOrder() {

    const cart = JSON.parse(localStorage.getItem("cartData")) || [];

    if (cart.length === 0) {
        alert("Keranjang kosong!");
        return;
    }

    const nama = prompt("Masukkan nama pembeli:");
    if (!nama) return;

    const url = "https://script.google.com/macros/s/AKfycbwm0KbG6SGAmIBThV_zxKUWxQ2r6U3tj-JX5ZZjbBLD9BltZG5S5ZqLkAdN0dh_m0VTPQ/exec";

    try {

        for (const item of cart) {

            await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "text/plain"
                },
                body: JSON.stringify({
                    nama: nama,
                    produk: item.name,
                    sn: item.sn || "",
                    keterangan: item.keterangan || "",
                    qty: item.qty,
                    total: "-",
                    status: "Baru"
                })
            });

        }

        alert("Order berhasil disimpan!");

        // PRINT LANGSUNG
        printOrder();

        // Reset setelah print
        setTimeout(() => {
            localStorage.removeItem("cartData");
            location.reload();
        }, 1500);

    } catch (error) {
    alert("Error detail: " + error);
    console.log(error);
}
}

        
    </script>
    </div>
</body>
</html>





